<form name="clusterForm">
    <div class="gf-form-group">
    	<div class="gf-form-inline">
    		<div class="gf-form">
    			<span class="gf-form-label width-7">Name</span>
    				<input class="gf-form-input max-width-21" type="text" ng-model="ctrl.cluster.name" placeholder="My cluster name" required="" />
    			</div>
    		</div>
    	</div>
    </div>
	<datasource-http-settings
		current="ctrl.cluster"
		suggest-url="http://localhost:8001">
	</datasource-http-settings>

  <h3 class="page-heading">Graphite Settings - Read</h3>
	<div class="gf-form-group">
    	<div class="gf-form-inline">
    		<div class="gf-form">
    			<span class="gf-form-label width-7">Datasource</span>
    				<select class="gf-form-input" ng-model="ctrl.cluster.jsonData.ds" ng-options="f.name as f.name for f in ctrl.datasources" required></select>
    			</div>
    		</div>
    	</div>
    </div>
    <h3 class="page-heading">Graphite Settings - Write</h3>
    <div class="gf-form-group">
    	<div class="gf-form-inline">
    		<div class="gf-form">
    			<span class="gf-form-label width-7">Carbon Host</span>
    				<input class="gf-form-input max-width-21" type="text" ng-model="ctrl.cluster.jsonData.server" placeholder="Carbon host" required="" />
            <info-popover mode="right-absolute">
              Specify a url to the Carbon Host. Metrics from Kubernetes are sent to the Carbon host and saved to Graphite.
            </info-popover>
    			</div>
    		</div>
    		<div class="gf-form">
    			<span class="gf-form-label width-7">Port</span>
    				<input class="gf-form-input max-width-21" type="number" ng-model="ctrl.cluster.jsonData.port" placeholder="2003" required="" />
    			</div>
    		</div>
    	</div>
    </div>

</form>
<div class="gf-form-group" ng-show="ctrl.isOrgEditor">
  	<button type="submit" class="btn btn-success" ng-click="ctrl.save()" ng-enabled="clusterform.$valid">Save</button>
  	<button type="submit" class="btn btn-success" ng-click="ctrl.deploy()" ng-enabled="clusterform.$valid">{{ctrl.snapDeployed ? 'Update and Deploy' : 'Deploy'}}</button>
  	<button type="submit" class="btn btn-secondary" ng-click="ctrl.undeploy()" ng-show="ctrl.snapDeployed" ng-enabled="clusterform.$valid">Undeploy</button>
  	<a class="btn btn-link" ng-click="ctrl.cancel();">Back to Kubernetes Cluster List</a>
</div>

<span class="gf-form-label width-14">
  <i class="fa fa-info-circle"></i>
  <a ng-click="ctrl.toggleHelp()" bs-tooltip="'click to show instructions and download links'" data-placement="bottom">
    Manual Deploy Instructions
  </a>
</span>

<div class="grafana-info-box span10" ng-if="ctrl.showHelp">
  <h5>Manual Deploy</h5>
  <p>The Deploy button will deploy the <a class="pointer highlight-word" href="https://hub.docker.com/r/raintank/snap_k8s/">Snap Kubernetes Docker image</a> that provides summary performance and availability metrics of a Kubernetes Node and its containers.</p>
  <p>If you want to deploy manually or to automate the deployment to Kubernetes, the following files are needed.</p>
  <p>
    <button type="button" class="btn btn-success" ng-click="ctrl.saveConfigMapToFile()">Download Daemonset ConfigMap</button>
    <button type="button" class="btn btn-success" ng-click="ctrl.saveKubestateConfigMapToFile()">Download Kubestate ConfigMap</button>
  </p>
  <button type="button" class="btn btn-success" ng-click="ctrl.saveDaemonSetToFile()">Download Daemonset</button>
  <button type="button" class="btn btn-success" ng-click="ctrl.saveDeploymentToFile()">Download Kubestate Deployment</button>


  <p class="small">(The ConfigMap is generated from the settings so remember to save your settings before downloading.)</p>
  <p>To deploy the Config Map and Daemon Set, execute the following:</p>
  <p><code>kubectl create -f snap-configmap.json</code></p>
  <p><code>kubectl create -f snap-kubestate-configmap.json</code></p>
  <p><code>kubectl create -f snap-daemonset.json</code></p>
  <p><code>kubectl create -f snap-kubestate.json</code></p>
  <br />
  <h5>Removing the Daemon Set and Config Map</h5>
  <p><code>kubectl delete daemonsets -n kube-system snap</code></p>
  <p><code>kubectl delete deployments -n kube-system snap-kubestate-deployment</code></p>
  <p><code>kubectl delete configmaps -n kube-system snap-tasks</code></p>
  <p><code>kubectl delete configmaps -n kube-system snap-tasks-kubestate</code></p>

</div>
