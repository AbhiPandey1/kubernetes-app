{"version":3,"sources":["../../../src/components/clusters/podInfo.js"],"names":["slugify","str","slug","replace","moment","PodInfoCtrl","$scope","$injector","backendSrv","datasourceSrv","$q","$location","alertSrv","pageReady","pod","search","set","cluster_id","cluster","namespace","pod_name","loadDatasource","then","clusterDS","getPod","id","get","datasource","ds","jsonData","name","condition","status","type","value","text","path","spec","nodeName","metadata","conditionStatus","time","format","templateUrl"],"mappings":"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","file":"podInfo.js","sourcesContent":["import moment from 'moment';\n\nfunction slugify(str) {\n  var slug = str.replace(\"@\", \"at\").replace(\"&\", \"and\").replace(\".\", \"_\").replace(\"/\\W+/\", \"\");\n  return slug;\n}\n\nexport class PodInfoCtrl {\n  /** @ngInject */\n  constructor($scope, $injector, backendSrv, datasourceSrv, $q, $location, alertSrv) {\n    this.$q = $q;\n    this.backendSrv = backendSrv;\n    this.datasourceSrv = datasourceSrv;\n    this.$location = $location;\n\n    this.pageReady = false;\n    this.pod = {};\n    if (!(\"cluster\" in $location.search() && \"namespace\" in $location.search())) {\n      alertSrv.set(\"no cluster or namespace specified.\", \"no cluster or namespace specified in url\", 'error');\n      return;\n    } else {\n      this.cluster_id = $location.search().cluster;\n      this.namespace  = $location.search().namespace;\n      let pod_name    = $location.search().pod;\n\n      this.loadDatasource(this.cluster_id).then(() => {\n        this.clusterDS.getPod(this.namespace, pod_name).then(pod => {\n          this.pod = pod;\n          this.pageReady = true;\n        });\n      });\n    }\n  }\n\n  loadDatasource(id) {\n    return this.backendSrv.get('api/datasources/' + id)\n      .then(ds => {\n        this.datasource = ds.jsonData.ds;\n        return this.datasourceSrv.get(ds.name);\n      }).then(clusterDS => {\n        this.clusterDS = clusterDS;\n        return clusterDS;\n      });\n  }\n\n  conditionStatus(condition) {\n    var status;\n    if (condition.type === \"Ready\") {\n      status = condition.status === \"True\";\n    } else {\n      status = condition.status === \"False\";\n    }\n\n    return {\n      value: status,\n      text: status ? \"Ok\" : \"Error\"\n    };\n  }\n\n  goToPodDashboard(pod) {\n    this.$location.path(\"dashboard/db/kubernetes-container\")\n    .search({\n      \"var-datasource\": this.datasource,\n      \"var-cluster\": this.clusterDS.name,\n      \"var-node\": slugify(pod.spec.nodeName),\n      \"var-namespace\": pod.metadata.namespace,\n      \"var-pod\": pod.metadata.name\n    });\n  }\n\n  isConditionOk(condition) {\n    return this.conditionStatus(condition).value;\n  }\n\n  formatTime(time) {\n    return moment(time).format('YYYY-MM-DD HH:mm:ss');\n  }\n}\n\nPodInfoCtrl.templateUrl = 'components/clusters/partials/pod_info.html';\n"]}